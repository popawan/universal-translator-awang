
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾ç¾¤å…¨èƒ½ç¿»è­¯åŠ©æ‰‹</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f6f6f6; }
    button { margin: 5px; padding: 5px 10px; }
    #response { margin-top: 20px; background: white; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; }
    textarea, input[type="password"] { width: 100%; padding: 5px; margin-top: 10px; }
  </style>
  <script src="i18n.js">
    function checkStoredKey() {
      const key = getKey();
      if (key) {
        document.getElementById("apiKeyInput").style.display = "none";
        document.getElementById("saveKeyBtn").style.display = "none";
        document.getElementById("inputLabel").style.display = "none";
      }
    }
    
    function checkStoredKey() {
      const key = getKey();
      if (key) {
        document.getElementById("apiKeyInput").style.display = "none";
        document.getElementById("saveKeyBtn").style.display = "none";
        document.getElementById("inputLabel").style.display = "none";
        document.getElementById("resetKeyBtn").style.display = "inline-block";
      }
    }
    function resetKey() {
      localStorage.removeItem("openai_api_key");
      document.getElementById("apiKeyInput").style.display = "inline-block";
      document.getElementById("saveKeyBtn").style.display = "inline-block";
      document.getElementById("inputLabel").style.display = "inline-block";
      document.getElementById("resetKeyBtn").style.display = "none";
      alert("ğŸ” é‡‘é‘°å·²æ¸…é™¤ï¼Œè«‹é‡æ–°è¼¸å…¥");
    }
    </script>
    
    
</head>
<body onload="applyTranslations(); checkStoredKey();">
  <div style="max-width: 600px; margin: 0 auto; text-align: center;">

  <div style="display: flex; align-items: center; margin-bottom: 20px;">
    <img src="avatar_circular.png" alt="avatar" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px;">
    <span style="font-weight: bold; font-size: 1.1em;">a'wang@thinking</span>
  </div>

  <h2 id="title">ğŸŒ ç¤¾ç¾¤å…¨èƒ½ç¿»è­¯åŠ©æ‰‹</h2>

  <label for="apiKeyInput" id="inputLabel">ğŸ”‘ è«‹è¼¸å…¥ä½ çš„ OpenAI API Keyï¼š</label>
  <input type="password" id="apiKeyInput" placeholder="sk-xxx..." style="width: 100%;">
<p style="color: #e67e22; font-size: 0.85em; margin-top: 4px;">âš ï¸ è«‹è¼¸å…¥ä½ åœ¨ OpenAI å¸³æˆ¶å–å¾—çš„ API é‡‘é‘°ï¼ˆé–‹é ­é€šå¸¸æ˜¯ sk-...ï¼‰</p>
  <button onclick="saveKey()" id="saveKeyBtn">å„²å­˜é‡‘é‘°</button>
  <button onclick="resetKey()" id="resetKeyBtn" style="display:none; margin-left: 10px;">æ›´æ›é‡‘é‘°</button>

  <p style="color: gray; font-size: 0.9em;">âš ï¸ æç¤ºï¼šé€å‡ºè«‹æŒ‰ Enterï¼Œæ›è¡Œè«‹æŒ‰ Shift + Enter</p>

  <div style="margin-top: 20px;">
    <button onclick="setPrefix('q')" id="btn1">ç¹ä¸­</button>
    <button onclick="setPrefix('w')" id="btn2">ç¾å¼è‹±èª</button>
    <button onclick="setPrefix('e')" id="btn3">æ—¥æ–‡</button>
    <button onclick="setPrefix('r')" id="btn4">éŸ“æ–‡</button>
  </div>

  <textarea id="userInput" placeholder="è«‹è¼¸å…¥è¦ç¿»è­¯çš„å…§å®¹..."></textarea>
  <p style="color: #888; font-size: 0.85em;">âš ï¸ æŒ‰ Enter ç‚ºé€å‡ºç¿»è­¯ï¼Œæ›è¡Œè«‹ä½¿ç”¨ Shift + Enter</p>
  <button onclick="sendToGPT()" id="translateBtn">é€å‡º</button>

  </div>
<div id="response"></div>

  <script>
    let prefix = 'q'; // é è¨­ç¹ä¸­

    function applyTranslations() {
      document.getElementById("title").innerText = t.title;
      document.getElementById("inputLabel").innerText = t.inputLabel;
      document.getElementById("saveKeyBtn").innerText = t.saveKey;
      document.getElementById("translateBtn").innerText = t.translateBtn;
      document.getElementById("btn1").innerText = t.langButtons[0];
      document.getElementById("btn2").innerText = t.langButtons[1];
      document.getElementById("btn3").innerText = t.langButtons[2];
      document.getElementById("btn4").innerText = t.langButtons[3];
      document.getElementById("userInput").placeholder = t.inputPlaceholder;
    }

    function setPrefix(p) { prefix = p; }

    function saveKey() {
      const key = document.getElementById("apiKeyInput").value;
      localStorage.setItem("openai_api_key", key);
      alert("API Key å·²å„²å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ä¸­ï¼");
    }

    function getKey() {
      return localStorage.getItem("openai_api_key");
    }

    async function sendToGPT() {
      const input = document.getElementById("userInput").value;
      const apiKey = getKey();
      if (!apiKey) {
        alert(t.apiKeyWarning);
        return;
      }
      const message = prefix + " " + input;

      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + apiKey
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [
            { role: "system", content: "ä½ æ˜¯ä¸€å€‹å…¨èƒ½ç¿»è­¯åŠ©æ‰‹ï¼Œæ”¯æ´å››ç¨®èªè¨€ï¼šq ç¹ä¸­, w ç¾å¼è‹±èª, e æ—¥æ–‡, r éŸ“æ–‡ï¼Œè«‹æ ¹æ“šç”¨æˆ¶å‰ç¶´ç¿»è­¯ã€‚" },
            { role: "user", content: message }
          ]
        })
      });

      const data = await res.json();
      const outputArea = document.getElementById("response");
      if (data.error) {
        outputArea.innerText = "âš ï¸ éŒ¯èª¤ï¼š" + data.error.message;
      } else {
        const reply = data.choices[0].message.content;
        outputArea.innerText = t.gptResponse + reply;
        try {
          await navigator.clipboard.writeText(reply);
          alert(t.successCopy);
        } catch (err) {
          alert(t.errorCopy);
        }
      }
    }

    document.getElementById("userInput").addEventListener("keydown", function(event) {
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault();
        sendToGPT();
      }
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault();
        sendToGPT();
      }
    });
  
    function checkStoredKey() {
      const key = getKey();
      if (key) {
        document.getElementById("apiKeyInput").style.display = "none";
        document.getElementById("saveKeyBtn").style.display = "none";
        document.getElementById("inputLabel").style.display = "none";
      }
    }
    
    function checkStoredKey() {
      const key = getKey();
      if (key) {
        document.getElementById("apiKeyInput").style.display = "none";
        document.getElementById("saveKeyBtn").style.display = "none";
        document.getElementById("inputLabel").style.display = "none";
        document.getElementById("resetKeyBtn").style.display = "inline-block";
      }
    }
    function resetKey() {
      localStorage.removeItem("openai_api_key");
      document.getElementById("apiKeyInput").style.display = "inline-block";
      document.getElementById("saveKeyBtn").style.display = "inline-block";
      document.getElementById("inputLabel").style.display = "inline-block";
      document.getElementById("resetKeyBtn").style.display = "none";
      alert("ğŸ” é‡‘é‘°å·²æ¸…é™¤ï¼Œè«‹é‡æ–°è¼¸å…¥");
    }
    </script>
    
    
</div>
</body>
</html>
